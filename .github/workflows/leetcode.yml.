name: Update LeetCode Stats

on:
  schedule:
    - cron: '0 0 * * *' # Runs every day at midnight

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install requests
        run: pip install requests

      - name: Fetch LeetCode stats
        run: |
          import requests
          import os

          username = "akbar2habibullah"
          url = f"https://leetcode.com/api/problems/akbar2habibullah/"
          response = requests.get(url)
          data = response.json()

          total_solved = data["num_solved"]
          easy_solved = data["ac_easy"]
          medium_solved = data["ac_medium"]
          hard_solved = data["ac_hard"]

          leetcode_stats = f"Total Problems Solved: {total_solved}\nEasy Problems Solved: {easy_solved}\nMedium Problems Solved: {medium_solved}\nHard Problems Solved: {hard_solved}"

          gist_id = "a2447f658ebd06065f205cb0e6447cd6"
          headers = {"Authorization": f"token {os.getenv('GH_TOKEN')}"}
          data = {"description": "LeetCode Stats", "public": True, "files": {"LeetCode Stats": {"content": leetcode_stats}}}
          response = requests.patch(f"https://api.github.com/gists/{gist_id}", headers=headers, json=data)
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
